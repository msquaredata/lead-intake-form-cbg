<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/styles/main.css">
  <title>Charlton Bleecker ‚Äî Deal Prospect Intake</title>
</head>

<body>
  <!-- (All existing markup unchanged) -->
  <!-- ... truncated for brevity ... -->
  <footer>¬© 2025 Charlton Bleecker Group LLC ‚Äî All rights reserved.</footer>
  </main>

<script>
document.addEventListener("DOMContentLoaded", () => {
  console.log("‚úÖ DOM fully loaded ‚Äî initializing dropdown diagnostics...");

  /* ======= Initialize custom multiselect dropdowns ======= */
  document.querySelectorAll(".multiselect-dropdown").forEach((dropdown, i) => {
    const button = dropdown.querySelector(".dropdown-btn");
    const list = dropdown.querySelector(".dropdown-list");
    const hiddenInput = document.createElement("input");
    hiddenInput.type = "hidden";
    hiddenInput.name = dropdown.dataset.name;
    dropdown.appendChild(hiddenInput);

    const defaultText = button.textContent.trim();

    const updateDropdown = () => {
      const selected = Array.from(list.querySelectorAll("input:checked")).map(cb => cb.value);
      hiddenInput.value = selected.join(", ");

      let newText;
      if (selected.length === 0) {
        newText = defaultText;
        button.classList.remove("has-selection");
      } else if (selected.length === 1) {
        newText = selected[0];
        button.classList.add("has-selection");
      } else {
        newText = `${selected.length} items selected`;
        button.classList.add("has-selection");
      }
      button.textContent = newText;
    };

    updateDropdown();

    /* ======= Diagnostic click handler ======= */
    button.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropdown.classList.toggle("open");

      console.log(
        `üü° Dropdown button clicked (#${i + 1}):`,
        dropdown.dataset.name,
        "‚Üí Now open?",
        dropdown.classList.contains("open")
      );
    });

    /* ======= Checkbox change handler ======= */
    list.querySelectorAll("input[type='checkbox']").forEach(cb => {
      cb.addEventListener("change", updateDropdown);
    });

    /* ======= Outside click close ======= */
    document.addEventListener("click", (e) => {
      if (!dropdown.contains(e.target)) {
        dropdown.classList.remove("open");
      }
    });
  });

  console.log("‚úÖ Dropdown initialization complete ‚Äî waiting for clicks...");

  /* ======= Handle form submission (unchanged) ======= */
  const form = document.getElementById("leadForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const button = form.querySelector("button[type='submit']");
    button.disabled = true;
    button.textContent = "Submitting...";

    const formData = new FormData(form);
    const formObject = Object.fromEntries(formData.entries());

    document.querySelectorAll(".multiselect-dropdown input[type='hidden']").forEach(input => {
      formObject[input.name] = input.value;
    });

    try {
      const response = await fetch(form.action, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formObject),
      });

      const data = await response.json();

      if (response.ok && data.status === "received") {
        const redirectURL = data.redirect || "thank-you.html";
        setTimeout(() => (window.location.href = redirectURL), 800);
      } else {
        alert("Submission failed. Please try again.");
        button.disabled = false;
        button.textContent = "Submit Opportunity";
      }
    } catch (error) {
      console.error("‚ùå Error submitting form:", error);
      alert("Unable to connect to the server. Please try again later.");
      button.disabled = false;
      button.textContent = "Submit Opportunity";
    }
  });
});
</script>
</body>
</html>
